# .github/workflows/monitor-kvsb-usage.yml
# 毎日 JST 09:30（= UTC 00:30）に実行されます

name: 📊 Monitor KV & Supabase Usage：KV & Supabase 使用状況統合モニタリング（80% 警告通知）

on:
  schedule:
    - cron: '30 0 * * *'   # 毎日、JST 09:30 = UTC 00:30
  workflow_dispatch:       # 手動実行も可能

jobs:
  check-usage:
    runs-on: ubuntu-latest

    steps:
      - name: 📦 リポジトリをチェックアウト
        uses: actions/checkout@v4

      - name: 🚀 スクリプト実行（KV & Supabase 監視）
        env:
          KV_API_TOKEN_FFDEV: ${{ secrets.KV_API_TOKEN_FFDEV }}
          KV_API_TOKEN_FFPROD: ${{ secrets.KV_API_TOKEN_FFPROD }}
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
          CF_ACCOUNT_ID: ${{ secrets.CF_ACCOUNT_ID }}
        run: node /home/runner/work/inuichiba-ffscripts/inuichiba-ffscripts/yml-monitor-kvsb-usage.js
