# kvapi-delete-groupkeys.yml
# groupIdãŒCã§å§‹ã¾ã‚‹(groupãƒ©ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼)ã‚’500ä»¶delteã™ã‚‹ã€‚
# èª²é‡‘æ ã‚’è¶…ãˆã‚‹ã®ã§ã€ä¸€æ—¥1å›ã ã‘å®Ÿè¡Œã®ã“ã¨ã€‚
#
# ğŸ“Œ ã“ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¯è‡ªå‹•çš„ã« Cloudflare Workers ã® KV ã‹ã‚‰ã€
#     groupId ãŒç‰¹å®šæ–‡å­—ã§å§‹ã¾ã‚‹ã‚­ãƒ¼ï¼ˆä¾‹: Cï¼‰ã‚’å‰Šé™¤ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®šæœŸå®Ÿè¡Œã—ã¾ã™ã€‚
# ğŸ”’ KV_API_URL_FFPROD ãŠã‚ˆã³ KV_API_TOKEN_FFPROD ã¯ GitHub Secrets ã«ç™»éŒ²æ¸ˆã¿ã§ã‚ã‚‹ã“ã¨ãŒå‰æã§ã™ã€‚
# ğŸš« é€šå¸¸ã¯æ‰‹å‹•å®Ÿè¡Œã—ã¾ã›ã‚“ãŒã€å¿…è¦ã«å¿œã˜ã¦ workflow_dispatch ã‚’ä½¿ã£ã¦è©•ä¾¡å¯èƒ½ã§ã™ã€‚
# ğŸ§¼ ä¸»ã« Supabase ã«é€€é¿æ¸ˆã®ãƒ‡ãƒ¼ã‚¿ã«å¯¾å¿œã—ãŸã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ç”¨é€”ã§ã™ã€‚

name: Delete C-prefixed KV keys

on:
  workflow_dispatch:

jobs:
  delete-group-keys:
    runs-on: ubuntu-latest

    steps:
      # ğŸ“¦ ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
      - name: Checkout repository
        uses: actions/checkout@v3

      # ğŸ§  Node.js v20 ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 20

      # ğŸ“¦ ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
      - name: Install dependencies
        run: npm ci

      # ğŸš€ Cã§å§‹ã¾ã‚‹KVã‚­ãƒ¼ã‚’å‰Šé™¤ï¼ˆgroupIdã®æ¥é ­è¾ãŒ "C" ã®ã¿å¯¾è±¡ï¼‰
      - name: Run kvapi-delete-groupkeys.js
        run: node kvapi-delete-groupkeys.js
        env:
          KV_API_URL_FFPROD: ${{ secrets.KV_API_URL_FFPROD }}
          KV_API_TOKEN_FFPROD: ${{ secrets.KV_API_TOKEN_FFPROD }}

      # âœ… å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
      - name: Post Checkout repository
        run: echo "âœ… Delete C-prefixed KV keys å®Œäº†ã—ã¾ã—ãŸ"
