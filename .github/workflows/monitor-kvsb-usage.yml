# .github/workflows/monitor-kvsb-usage.yml
# æ¯æ—¥ JST 09:30ï¼ˆ= UTC 00:30ï¼‰ã«å®Ÿè¡Œã•ã‚Œã¾ã™

name: ğŸ“Š Monitor KV & Supabase Usageï¼šKV & Supabase ä½¿ç”¨çŠ¶æ³çµ±åˆãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ï¼ˆ80% è­¦å‘Šé€šçŸ¥ï¼‰

on:
  schedule:
    - cron: '30 0 * * *'   # æ¯æ—¥ã€JST 09:30 = UTC 00:30
  workflow_dispatch:       # æ‰‹å‹•å®Ÿè¡Œã‚‚å¯èƒ½

jobs:
  check-usage:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¦ ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4

      - name: ğŸš€ ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œï¼ˆKV & Supabase ç›£è¦–ï¼‰
        env:
          KV_API_TOKEN_FFDEV: ${{ secrets.KV_API_TOKEN_FFDEV }}
          KV_API_TOKEN_FFPROD: ${{ secrets.KV_API_TOKEN_FFPROD }}
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
          CF_ACCOUNT_ID: ${{ secrets.CF_ACCOUNT_ID }}
        run: node /home/runner/work/inuichiba-ffscripts/inuichiba-ffscripts/yml-monitor-kvsb-usage.js
